import{a as V}from"./index.03e7b8e2.js";import{as as T,aw as Ie,M as _e,d as me,e as H,aG as ue,h as ne,bN as ve,bO as Se,bP as ze,k as pe,l as ge,bq as Ee,r as k,bQ as Le,aj as Ce,o as y,w as ce,p as we,N as ye,s as h,t as de,S as m,v as E,F as b,y as p,x as e,z as fe,A as Ne,C as L,E as O,aa as xe,D as x,O as ae,a2 as Oe,a3 as Te,bR as Re,ag as $e,B as Ae,bS as Be,bT as Ve,P as Me,R as Pe,a0 as Ye,G as te,W as De,br as Xe,_ as be,bU as Fe,ac as he,j as He,I as je,aU as We,ab as Ke,H as Ge,bV as Ue}from"./index.a5d548f2.js";import{m as ke,u as qe}from"./index.fed4b7ea.js";import{d as Ze,E as B}from"./aria.973e6ceb.js";const Qe=(o,c)=>{if(!T||!o||!c)return!1;const n=o.getBoundingClientRect();let d;return c instanceof Element?d=c.getBoundingClientRect():d={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},n.top<d.bottom&&n.bottom>d.top&&n.right>d.left&&n.left<d.right};var Je="Expected a function";function ie(o,c,n){var d=!0,l=!0;if(typeof o!="function")throw new TypeError(Je);return Ie(n)&&(d="leading"in n?!!n.leading:d,l="trailing"in n?!!n.trailing:l),Ze(o,c,{leading:d,maxWait:c,trailing:l})}const et=(o,c)=>{if(!T)return!1;const n={undefined:"overflow",true:"overflow-y",false:"overflow-x"}[String(c)],d=_e(o,n);return["scroll","auto","overlay"].some(l=>d.includes(l))},tt=(o,c)=>{if(!T)return;let n=o;for(;n;){if([window,document,document.documentElement].includes(n))return window;if(et(n,c))return n;n=n.parentNode}return n},at=me({urlList:{type:H(Array),default:()=>ke([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),nt={close:()=>!0,switch:o=>ue(o),rotate:o=>ue(o)},st=["src","crossorigin"],ot=ne({name:"ElImageViewer"}),lt=ne({...ot,props:at,emits:nt,setup(o,{expose:c,emit:n}){var d;const l=o,w={CONTAIN:{name:"contain",icon:ve(Se)},ORIGINAL:{name:"original",icon:ve(ze)}},{t:se}=pe(),u=ge("image-viewer"),{nextZIndex:M}=Ee(),C=k(),N=k([]),R=Le(),I=k(!0),f=k(l.initialIndex),$=Ce(w.CONTAIN),r=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),P=k((d=l.zIndex)!=null?d:M()),oe=y(()=>{const{urlList:a}=l;return a.length<=1}),j=y(()=>f.value===0),W=y(()=>f.value===l.urlList.length-1),Y=y(()=>l.urlList[f.value]),le=y(()=>[u.e("btn"),u.e("prev"),u.is("disabled",!l.infinite&&j.value)]),K=y(()=>[u.e("btn"),u.e("next"),u.is("disabled",!l.infinite&&W.value)]),D=y(()=>{const{scale:a,deg:s,offsetX:i,offsetY:_,enableTransition:z}=r.value;let g=i/a,S=_/a;switch(s%360){case 90:case-270:[g,S]=[S,-g];break;case 180:case-180:[g,S]=[-g,-S];break;case 270:case-90:[g,S]=[-S,g];break}const A={transform:`scale(${a}) rotate(${s}deg) translate(${g}px, ${S}px)`,transition:z?"transform .3s":""};return $.value.name===w.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A});function X(){G(),n("close")}function re(){const a=ie(i=>{switch(i.code){case B.esc:l.closeOnPressEscape&&X();break;case B.space:J();break;case B.left:ee();break;case B.up:v("zoomIn");break;case B.right:t();break;case B.down:v("zoomOut");break}}),s=ie(i=>{const _=i.deltaY||i.deltaX;v(_<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});R.run(()=>{V(document,"keydown",a),V(document,"wheel",s)})}function G(){R.stop()}function U(){I.value=!1}function q(a){I.value=!1,a.target.alt=se("el.image.error")}function Z(a){if(I.value||a.button!==0||!C.value)return;r.value.enableTransition=!1;const{offsetX:s,offsetY:i}=r.value,_=a.pageX,z=a.pageY,g=ie(A=>{r.value={...r.value,offsetX:s+A.pageX-_,offsetY:i+A.pageY-z}}),S=V(document,"mousemove",g);V(document,"mouseup",()=>{S()}),a.preventDefault()}function Q(){r.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function J(){if(I.value)return;const a=Fe(w),s=Object.values(w),i=$.value.name,z=(s.findIndex(g=>g.name===i)+1)%a.length;$.value=w[a[z]],Q()}function F(a){const s=l.urlList.length;f.value=(a+s)%s}function ee(){j.value&&!l.infinite||F(f.value-1)}function t(){W.value&&!l.infinite||F(f.value+1)}function v(a,s={}){if(I.value)return;const{minScale:i,maxScale:_}=l,{zoomRate:z,rotateDeg:g,enableTransition:S}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...s};switch(a){case"zoomOut":r.value.scale>i&&(r.value.scale=Number.parseFloat((r.value.scale/z).toFixed(3)));break;case"zoomIn":r.value.scale<_&&(r.value.scale=Number.parseFloat((r.value.scale*z).toFixed(3)));break;case"clockwise":r.value.deg+=g,n("rotate",r.value.deg);break;case"anticlockwise":r.value.deg-=g,n("rotate",r.value.deg);break}r.value.enableTransition=S}return ce(Y,()=>{we(()=>{const a=N.value[0];a!=null&&a.complete||(I.value=!0)})}),ce(f,a=>{Q(),n("switch",a)}),ye(()=>{var a,s;re(),(s=(a=C.value)==null?void 0:a.focus)==null||s.call(a)}),c({setActiveItem:F}),(a,s)=>(h(),de(Xe,{to:"body",disabled:!a.teleported},[m(De,{name:"viewer-fade",appear:""},{default:E(()=>[b("div",{ref_key:"wrapper",ref:C,tabindex:-1,class:p(e(u).e("wrapper")),style:fe({zIndex:P.value})},[b("div",{class:p(e(u).e("mask")),onClick:s[0]||(s[0]=Ne(i=>a.hideOnClickModal&&X(),["self"]))},null,2),L(" CLOSE "),b("span",{class:p([e(u).e("btn"),e(u).e("close")]),onClick:X},[m(e(O),null,{default:E(()=>[m(e(xe))]),_:1})],2),L(" ARROW "),e(oe)?L("v-if",!0):(h(),x(ae,{key:0},[b("span",{class:p(e(le)),onClick:ee},[m(e(O),null,{default:E(()=>[m(e(Oe))]),_:1})],2),b("span",{class:p(e(K)),onClick:t},[m(e(O),null,{default:E(()=>[m(e(Te))]),_:1})],2)],64)),L(" ACTIONS "),b("div",{class:p([e(u).e("btn"),e(u).e("actions")])},[b("div",{class:p(e(u).e("actions__inner"))},[m(e(O),{onClick:s[1]||(s[1]=i=>v("zoomOut"))},{default:E(()=>[m(e(Re))]),_:1}),m(e(O),{onClick:s[2]||(s[2]=i=>v("zoomIn"))},{default:E(()=>[m(e($e))]),_:1}),b("i",{class:p(e(u).e("actions__divider"))},null,2),m(e(O),{onClick:J},{default:E(()=>[(h(),de(Ae(e($).icon)))]),_:1}),b("i",{class:p(e(u).e("actions__divider"))},null,2),m(e(O),{onClick:s[3]||(s[3]=i=>v("anticlockwise"))},{default:E(()=>[m(e(Be))]),_:1}),m(e(O),{onClick:s[4]||(s[4]=i=>v("clockwise"))},{default:E(()=>[m(e(Ve))]),_:1})],2)],2),L(" CANVAS "),b("div",{class:p(e(u).e("canvas"))},[(h(!0),x(ae,null,Me(a.urlList,(i,_)=>Pe((h(),x("img",{ref_for:!0,ref:z=>N.value[_]=z,key:i,src:i,style:fe(e(D)),class:p(e(u).e("img")),crossorigin:a.crossorigin,onLoad:U,onError:q,onMousedown:Z},null,46,st)),[[Ye,_===f.value]])),128))],2),te(a.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var rt=be(lt,[["__file","image-viewer.vue"]]);const it=he(rt),ut=me({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:H([String,Object])},previewSrcList:{type:H(Array),default:()=>ke([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},crossorigin:{type:H(String)}}),ct={load:o=>o instanceof Event,error:o=>o instanceof Event,switch:o=>ue(o),close:()=>!0,show:()=>!0},dt=["src","loading","crossorigin"],ft={key:0},vt=ne({name:"ElImage",inheritAttrs:!1}),mt=ne({...vt,props:ut,emits:ct,setup(o,{emit:c}){const n=o;let d="";const{t:l}=pe(),w=ge("image"),se=He(),u=qe(),M=k(),C=k(!1),N=k(!0),R=k(!1),I=k(),f=k(),$=T&&"loading"in HTMLImageElement.prototype;let r,P;const oe=y(()=>[w.e("inner"),Y.value&&w.e("preview"),N.value&&w.is("loading")]),j=y(()=>se.style),W=y(()=>{const{fit:t}=n;return T&&t?{objectFit:t}:{}}),Y=y(()=>{const{previewSrcList:t}=n;return Array.isArray(t)&&t.length>0}),le=y(()=>{const{previewSrcList:t,initialIndex:v}=n;let a=v;return v>t.length-1&&(a=0),a}),K=y(()=>n.loading==="eager"?!1:!$&&n.loading==="lazy"||n.lazy),D=()=>{!T||(N.value=!0,C.value=!1,M.value=n.src)};function X(t){N.value=!1,C.value=!1,c("load",t)}function re(t){N.value=!1,C.value=!0,c("error",t)}function G(){Qe(I.value,f.value)&&(D(),Z())}const U=Ue(G,200,!0);async function q(){var t;if(!T)return;await we();const{scrollContainer:v}=n;We(v)?f.value=v:Ke(v)&&v!==""?f.value=(t=document.querySelector(v))!=null?t:void 0:I.value&&(f.value=tt(I.value)),f.value&&(r=V(f,"scroll",U),setTimeout(()=>G(),100))}function Z(){!T||!f.value||!U||(r==null||r(),f.value=void 0)}function Q(t){if(!!t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}function J(){!Y.value||(P=V("wheel",Q,{passive:!1}),d=document.body.style.overflow,document.body.style.overflow="hidden",R.value=!0,c("show"))}function F(){P==null||P(),document.body.style.overflow=d,R.value=!1,c("close")}function ee(t){c("switch",t)}return ce(()=>n.src,()=>{K.value?(N.value=!0,C.value=!1,Z(),q()):D()}),ye(()=>{K.value?q():D()}),(t,v)=>(h(),x("div",{ref_key:"container",ref:I,class:p([e(w).b(),t.$attrs.class]),style:fe(e(j))},[C.value?te(t.$slots,"error",{key:0},()=>[b("div",{class:p(e(w).e("error"))},Ge(e(l)("el.image.error")),3)]):(h(),x(ae,{key:1},[M.value!==void 0?(h(),x("img",je({key:0},e(u),{src:M.value,loading:t.loading,style:e(W),class:e(oe),crossorigin:t.crossorigin,onClick:J,onLoad:X,onError:re}),null,16,dt)):L("v-if",!0),N.value?(h(),x("div",{key:1,class:p(e(w).e("wrapper"))},[te(t.$slots,"placeholder",{},()=>[b("div",{class:p(e(w).e("placeholder"))},null,2)])],2)):L("v-if",!0)],64)),e(Y)?(h(),x(ae,{key:2},[R.value?(h(),de(e(it),{key:0,"z-index":t.zIndex,"initial-index":e(le),infinite:t.infinite,"zoom-rate":t.zoomRate,"min-scale":t.minScale,"max-scale":t.maxScale,"url-list":t.previewSrcList,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:F,onSwitch:ee},{default:E(()=>[t.$slots.viewer?(h(),x("div",ft,[te(t.$slots,"viewer")])):L("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):L("v-if",!0)],64)):L("v-if",!0)],6))}});var pt=be(mt,[["__file","image.vue"]]);const ht=he(pt);export{ht as E};
